<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>çº¸ç‰Œè®°å¿†æ¸¸æˆ</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="ico.png" sizes="192x192" />
    <link rel="stylesheet" type="text/css" href="style.css">
    <!-- å¯¼å…¥bootstrapä»¥åŠå­—ä½“å›¾æ ‡ç­‰æ ·å¼ -->
    <link rel="stylesheet prefetch" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">
    <script src="script.js">
    </script>
</head>

<body>

    <div class="container">
        <header>
            <h1>çº¸ç‰Œè®°å¿†æ¸¸æˆ</h1>
        </header>
        <section class="score-panel">
            <ul class="stars">
                <li><i class="fa fa-star"></i></li>
                <li><i class="fa fa-star"></i></li>
                <li><i class="fa fa-star"></i></li>
            </ul>
            <span class="moves">0</span>
            <div class="timer"></div>
            <div class="restart" onclick="startGame()">
                <i class="fa fa-repeat"></i>
            </div>
        </section>
        <ul class="deck" id="card-deck">
            <li class="card" type="diamond"><i class="fa fa-diamond"></i></li>
            <li class="card" type="plane"><i class="fa fa-paper-plane-o"></i></li>
            <li class="card match" type="anchor"><i class="fa fa-anchor"></i> </li>
            <li class="card" type="bolt"><i class="fa fa-bolt"></i></li>
            <li class="card" type="cube"><i class="fa fa-cube"></i></li>
            <li class="card match" type="anchor"><i class="fa fa-anchor"></i></li>
            <li class="card" type="leaf"><i class="fa fa-leaf"></i></li>
            <li class="card" type="bicycle"><i class="fa fa-bicycle"></i></li>
            <li class="card" type="diamond"><i class="fa fa-diamond"></i></li>
            <li class="card" type="bomb"><i class="fa fa-bomb"></i></li>
            <li class="card" type="leaf"><i class="fa fa-leaf"></i></li>
            <li class="card" type="bomb"><i class="fa fa-bomb"></i></li>
            <li class="card open show" type="bolt"><i class="fa fa-bolt"></i></li>
            <li class="card" type="bicycle"><i class="fa fa-bicycle"></i></li>
            <li class="card" type="plane"><i class="fa fa-paper-plane-o"></i></li>
            <li class="card" type="cube"><i class="fa fa-cube"></i></li>
        </ul>
        <div id="popup1" class="overlay">
            <script>
                // å¡ç‰‡æ•°ç»„åŒ…å«æ‰€æœ‰å¡ç‰‡
                let card = document.getElementsByClassName("card");
                let cards = [...card];

                // æ¸¸æˆä¸­æ‰€æœ‰å¡ç‰‡
                const deck = document.getElementById("card-deck");

                // å£°æ˜ moves å˜é‡
                let moves = 0;
                let counter = document.querySelector(".moves");

                // å£°æ˜æ˜Ÿå½¢å›¾æ ‡çš„å˜é‡
                const stars = document.querySelectorAll(".fa-star");

                // å£°æ˜ matchedCard çš„å˜é‡
                let matchedCard = document.getElementsByClassName("match");

                // æ˜Ÿçº§åˆ—è¡¨
                let starsList = document.querySelectorAll(".stars li");

                // æ¨¡æ¿ä¸­çš„å…³é—­å›¾æ ‡
                let closeicon = document.querySelector(".close");

                // å£°æ˜ modal
                let modal = document.getElementById("popup1")

                // æ‰“å¼€å¡ç‰‡çš„æ•°ç»„
                var openedCards = [];


                // æ´—ç‰ŒåŠŸèƒ½
                function shuffle(array) {
                    var currentIndex = array.length,
                        temporaryValue, randomIndex;

                    while (currentIndex !== 0) {
                        randomIndex = Math.floor(Math.random() * currentIndex);
                        currentIndex -= 1;
                        temporaryValue = array[currentIndex];
                        array[currentIndex] = array[randomIndex];
                        array[randomIndex] = temporaryValue;
                    }

                    return array;
                };


                // é¡µé¢åˆ·æ–°/åŠ è½½æ—¶æ´—ç‰Œ
                document.body.onload = startGame();

                // å¼€å§‹æ–°æ¸¸æˆçš„åŠŸèƒ½
                function startGame() {

                    // æ¸…ç©º openCards æ•°ç»„
                    openedCards = [];

                    // æ´—ç‰Œ
                    cards = shuffle(cards);
                    // ä»æ¯å¼ å¡ç‰‡ä¸­åˆ é™¤æ‰€æœ‰ç°æœ‰çš„ç±»
                    for (var i = 0; i < cards.length; i++) {
                        deck.innerHTML = "";
                        [].forEach.call(cards, function(item) {
                            deck.appendChild(item);
                        });
                        cards[i].classList.remove("show", "open", "match", "disabled");
                    }
                    // é‡ç½® moves
                    moves = 0;
                    counter.innerHTML = moves;
                    // é‡ç½® rating
                    for (var i = 0; i < stars.length; i++) {
                        stars[i].style.color = "#FFD700";
                        stars[i].style.visibility = "visible";
                    }
                    // é‡ç½® timer
                    second = 0;
                    minute = 0;
                    hour = 0;
                    var timer = document.querySelector(".timer");
                    timer.innerHTML = "0 åˆ† 0 ç§’";
                    clearInterval(interval);
                }


                // æ˜¾ç¤ºå¡ç‰‡çš„åŠŸèƒ½
                var displayCard = function() {
                    this.classList.toggle("open");
                    this.classList.toggle("show");
                    this.classList.toggle("disabled");
                };


                // å°†æ‰“å¼€çš„å¡ç‰‡æ·»åŠ åˆ° OpenedCards åˆ—è¡¨å¹¶æ£€æŸ¥å¡ç‰‡æ˜¯å¦åŒ¹é…
                function cardOpen() {
                    openedCards.push(this);
                    var len = openedCards.length;
                    if (len === 2) {
                        moveCounter();
                        if (openedCards[0].type === openedCards[1].type) {
                            matched();
                        } else {
                            unmatched();
                        }
                    }
                };


                // å½“å¡ç‰‡åŒ¹é…æ—¶çš„åŠŸèƒ½
                function matched() {
                    openedCards[0].classList.add("match", "disabled");
                    openedCards[1].classList.add("match", "disabled");
                    openedCards[0].classList.remove("show", "open", "no-event");
                    openedCards[1].classList.remove("show", "open", "no-event");
                    openedCards = [];
                }


                // å½“å¡ç‰‡ä¸åŒ¹é…æ—¶çš„åŠŸèƒ½
                function unmatched() {
                    openedCards[0].classList.add("unmatched");
                    openedCards[1].classList.add("unmatched");
                    disable();
                    setTimeout(function() {
                        openedCards[0].classList.remove("show", "open", "no-event", "unmatched");
                        openedCards[1].classList.remove("show", "open", "no-event", "unmatched");
                        enable();
                        openedCards = [];
                    }, 1100);
                }


                // æš‚æ—¶ç¦ç”¨å¡ç‰‡çš„åŠŸèƒ½
                function disable() {
                    Array.prototype.filter.call(cards, function(card) {
                        card.classList.add('disabled');
                    });
                }


                // å¯ç”¨å¡ç‰‡å¹¶ç¦ç”¨åŒ¹é…çš„å¡ç‰‡çš„åŠŸèƒ½
                function enable() {
                    Array.prototype.filter.call(cards, function(card) {
                        card.classList.remove('disabled');
                        for (var i = 0; i < matchedCard.length; i++) {
                            matchedCard[i].classList.add("disabled");
                        }
                    });
                }


                // è®¡ç®—ç©å®¶çš„åŠ¨ä½œçš„åŠŸèƒ½
                function moveCounter() {
                    moves++;
                    counter.innerHTML = moves;
                    // ç¬¬ä¸€æ¬¡ç‚¹å‡»æ—¶å¯åŠ¨è®¡æ—¶å™¨
                    if (moves == 1) {
                        second = 0;
                        minute = 0;
                        hour = 0;
                        startTimer();
                    }
                    // æ ¹æ®ç§»åŠ¨æ¬¡æ•°è®¾ç½®æ˜Ÿçº§
                    if (moves > 8 && moves < 12) {
                        for (i = 0; i < 3; i++) {
                            if (i > 1) {
                                stars[i].style.visibility = "collapse";
                            }
                        }
                    } else if (moves > 13) {
                        for (i = 0; i < 3; i++) {
                            if (i > 0) {
                                stars[i].style.visibility = "collapse";
                            }
                        }
                    }
                }


                // æ˜¾ç¤ºæ¸¸æˆçš„æ—¶é—´
                var second = 0,
                    minute = 0;
                hour = 0;
                var timer = document.querySelector(".timer");
                var interval;

                function startTimer() {
                    interval = setInterval(function() {
                        timer.innerHTML = minute + " åˆ†" + second + " ç§’";
                        second++;
                        if (second == 60) {
                            minute++;
                            second = 0;
                        }
                        if (minute == 60) {
                            hour++;
                            minute = 0;
                        }
                    }, 1000);
                }


                // æ‰€æœ‰å¡ç‰‡åŒ¹é…åŒ¹é…æ—¶å±•ç¤ºæ­å–œç•Œé¢ï¼Œæ˜¾ç¤ºç§»åŠ¨æ¬¡æ•°æ—¶é—´å’Œç­‰çº§
                function congratulations() {
                    if (matchedCard.length == 16) {
                        clearInterval(interval);
                        finalTime = timer.innerHTML;

                        // æ˜¾ç¤ºç¥è´ºæ¨¡æ¿
                        modal.classList.add("show");

                        // å£°æ˜æ˜Ÿçº§å˜é‡
                        var starRating = document.querySelector(".stars").innerHTML;

                        // æ˜¾ç¤ºç§»åŠ¨ã€è¯„çº§ã€æ—¶é—´
                        document.getElementById("finalMove").innerHTML = moves;
                        document.getElementById("starRating").innerHTML = starRating;
                        document.getElementById("totalTime").innerHTML = finalTime;

                        //æ¨¡æ¿ä¸Šçš„å…³é—­å›¾æ ‡
                        closeModal();
                    };
                }


                // ç•Œé¢ä¸Šçš„å…³é—­å›¾æ ‡
                function closeModal() {
                    closeicon.addEventListener("click", function(e) {
                        modal.classList.remove("show");
                        startGame();
                    });
                }


                // å†æ¬¡æ¸¸æˆåŠŸèƒ½
                function playAgain() {
                    modal.classList.remove("show");
                    startGame();
                }


                // å¾ªç¯ä»¥å°†äº‹ä»¶ä¾¦å¬å™¨æ·»åŠ åˆ°æ¯å¼ å¡ç‰‡
                for (var i = 0; i < cards.length; i++) {
                    card = cards[i];
                    card.addEventListener("click", displayCard);
                    card.addEventListener("click", cardOpen);
                    card.addEventListener("click", congratulations);
                };
            </script>
            <div class="popup">
                <h2>æ­å–œ ğŸ‰</h2>
                <a class="close" href="#">Ã—</a>
                <div class="content-1">
                    æ­å–œä½ è·å¾—äº†èƒœåˆ© ğŸ‰ğŸ‰
                </div>
                <div class="content-2">
                    <p>ä½ åœ¨<span id="totalTime"> </span>å†… </p>
                    <p>ç§»åŠ¨äº†<span id="finalMove"> </span> æ¬¡ </p>
                    <p>æ˜Ÿçº§: <span id="starRating"></span></p>
                </div>
                <button id="play-again" onclick="playAgain()">
                    å†ç©ä¸€æ¬¡ ğŸ˜„</a>
                </button>
            </div>
        </div>
    </div>
    <footer class="page-footer">
        <span>æ›´å¤šæ¸¸æˆğŸ‘‰</span>
        <a href="https://haiyong.site/moyu" target="_blank">
            <img class="touxiang" src="https://haiyong.site/img/favicon.png" alt="George Martsoukos logo">
        </a>
    </footer>
    <footer class="haiyong-left">

        <a href="https://code.haiyong.site/ziyuan/game/" target="_blank">
            <img class="touxiang" src="https://code.haiyong.site/wp-content/uploads/2022/10/logo.jpg" alt="George Martsoukos logo">
        </a>
        <span>ğŸ‘ˆæ¸¸æˆæºç </span>
    </footer>
</body>

</html>